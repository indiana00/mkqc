<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>SmartPantry é£Ÿç‰©ç®¡å®¶</title>
  <style>
    :root {
      --main: #6aac6e;
      --main-dark: #4e8c51;
      --bg: #f6f8f2;
      --white: #fff;
      --accent: #e08e3b;
      --error: #d90429;
      --text: #2e2e2e;
      --shadow: 0 2px 10px rgba(106,172,110,.11);
      --radius: 18px;
      --transition: 0.22s;
      --footer-height: 62px;
      --skeleton: #e9ecdf;
    }
    html, body {
      margin:0; padding:0;
      background:var(--bg);
      color:var(--text);
      font-family:"PingFang TC", "Noto Sans TC", Arial, sans-serif;
      font-size: 17px;
      scroll-behavior: smooth;
    }
    body {
      min-height: 100vh;
      padding-bottom: var(--footer-height);
    }
    .hidden { display: none !important; }
    .header {
      background: linear-gradient(90deg, var(--main-dark) 0%, var(--main) 100%);
      color: var(--white);
      padding: 20px 0 14px 0;
      text-align: center;
      font-size: 2.25rem;
      font-weight: bold;
      letter-spacing: 2.6px;
      box-shadow: 0 1px 8px rgba(106,172,110,0.13);
      position: sticky;
      top: 0; left: 0; right: 0;
      z-index: 40;
      border-radius: 0 0 24px 24px;
      transition: background .2s;
    }
    .container {
      padding: 22px 2vw 12px 2vw;
      max-width: 750px;
      margin: auto;
    }
    .form-card {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 28px 22px 23px 22px;
      margin-bottom: 24px;
      display: flex;
      flex-direction: column;
      gap: 19px;
      border: 1.5px solid #e6e6e6;
    }
    .form-group { display: flex; flex-direction: column; }
    label {
      font-weight: bold;
      margin-bottom: 6px;
      color: var(--main);
      letter-spacing: 1.2px;
    }
    input, select, textarea {
      width: 100%; padding: 11px 13px;
      border: 1.5px solid #c8e6c9;
      border-radius: 7px;
      font-size: 1.03rem;
      box-sizing: border-box;
      transition: border-color var(--transition), box-shadow var(--transition);
      background: #fafcf7;
      margin-bottom: 3px;
    }
    textarea { resize: vertical; min-height: 54px; }
    input:focus, select:focus, textarea:focus {
      border-color: var(--main);
      box-shadow: 0 0 0 2px #e2f5e1;
      outline: none;
    }
    .button, .btn-main {
      background: linear-gradient(90deg, var(--main-dark), var(--main));
      color: var(--white);
      border: none;
      padding: 14px 0;
      cursor: pointer;
      border-radius: 7px;
      font-size: 1.12rem;
      font-weight: bold;
      margin-top: 8px;
      box-shadow: 0 1px 5px rgba(106,172,110,0.09);
      transition: background var(--transition), opacity var(--transition);
      width: 100%;
      letter-spacing: 1.2px;
    }
    .button:disabled { opacity: 0.6; cursor: not-allowed; }
    .button:hover:enabled, .btn-main:hover:enabled { background:linear-gradient(90deg,var(--main), var(--main-dark)); }
    .input-error { border-color: var(--error)!important; }
    .error-text { color: var(--error); font-size: 0.95em; margin-top:2px;}
    .success-message, .error-message {
      padding: 12px; border-radius: 7px; margin-bottom: 17px; text-align: center;
      display: none;
      font-size: 1em;
    }
    .success-message { background: rgba(106,172,110,0.14); color: var(--main);}
    .error-message { background: rgba(217,4,41,0.11); color: var(--error);}
    /* åº•éƒ¨å°èˆªæ¬„ */
    .footer-nav {
      position: fixed; left: 0; right: 0; bottom: 0;
      height: var(--footer-height);
      background: var(--white);
      border-top: 1.5px solid #e6e6e6;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 100;
      box-shadow: 0 -2px 12px #e7e7e7;
      border-radius: 16px 16px 0 0;
    }
    .footer-nav button {
      background: none; border: none;
      padding: 0; margin: 0 4px;
      flex: 1; color: #7b8e7f;
      font-size: 1.11rem;
      display: flex; flex-direction: column; align-items: center;
      cursor: pointer; transition: color .2s;
      outline: none;
      font-weight: 600;
    }
    .footer-nav .active { color: var(--main);}
    .footer-nav svg { font-size: 1.45em; margin-bottom: 2px; }
    /* å¡ç‰‡ã€åˆ—è¡¨ç­‰ */
    .card, .food-card, .reminder-card, .list-item, .recipe-card, .chat-message {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 19px 14px 14px 16px;
      margin-bottom: 17px;
      border: 1px solid #f0f0f0;
      transition: box-shadow .18s;
    }
    .food-card img, .market-food-img {
      width: 100%; height: 170px; object-fit: cover; border-radius: 10px; margin-bottom: 8px;
      background: var(--skeleton);
      transition: opacity .2s;
    }
    .food-card .content { padding-top: 6px; }
    .food-card .title { font-weight: bold; font-size: 1.13rem; margin-bottom: 3px;}
    .food-card .details { font-size: 0.97rem; color: #666; margin-bottom: 7px;}
    .food-card .timer { font-size: 0.98rem; color: #e63946; margin-bottom: 11px;}
    .food-card .actions { display: flex; justify-content: space-between; align-items: center;}
    /* ä¸»é å‹•æ…‹æ¶ˆæ¯ */
    .feed-post {
      background: var(--white);
      border-radius: var(--radius);
      padding: 16px 14px;
      margin-bottom: 15px;
      box-shadow: 0 2px 8px rgba(106,172,110,0.09);
      display: flex; gap: 14px; align-items: flex-start;
      border: 1px solid #f0f0f0;
    }
    .feed-avatar {
      width: 54px; height: 54px; border-radius: 50%; background: #d3ecd4;
      display: flex; align-items: center; justify-content: center; font-size: 1.6rem;
      border: 2px solid #e6e6e6;
    }
    .feed-content { flex: 1; }
    .feed-content .feed-user { font-weight: bold; color: #4e8c51; font-size: 1.07em;}
    .feed-content .feed-text { margin: 6px 0; font-size: 1em;}
    .feed-actions { display: flex; align-items: center; gap: 18px; font-size: 1em;}
    .feed-actions button { background: var(--main); border: none; color: #fff; cursor: pointer; font-weight: bold; border-radius: 6px; padding:6px 19px;}
    .feed-image { max-width: 120px; border-radius: 9px; margin-top: 7px; box-shadow:0 1px 6px #e6e6e6;}
    /* popupé®ç½© */
    .mask {
      position: fixed; left: 0; top: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.12);
      z-index: 999;
      display: flex; justify-content: center; align-items: center;
    }
    /* å…¶å®ƒæ¨£å¼ */
    .section-title {
      font-size: 1.29rem;
      font-weight: bold;
      color: var(--main-dark);
      margin-bottom: 15px;
      border-left: 5px solid var(--accent);
      padding-left: 12px;
      letter-spacing: 1.3px;
    }
    .map { width: 100%; height: 180px; background: #e2e2e2; display: flex; align-items: center; justify-content: center; font-size: 19px; color: #666; margin-bottom: 21px; border-radius: 11px;}
    .profile-header {
      display: flex; align-items: center; gap: 22px; margin-bottom: 20px;
    }
    .profile-header img { width: 74px; height: 74px; border-radius: 50%; border: 3px solid var(--main);}
    .profile-header .name { font-size: 1.25rem; font-weight: bold; color: var(--main);}
    .tabs { display: flex; justify-content: space-around; border-bottom: 2px solid #efefef; margin-bottom: 21px;}
    .tabs button {
      flex: 1; padding: 11px;
      font-size: 1.04rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 7px 7px 0 0;
      cursor: pointer;
      outline: none;
      font-weight: bold;
      margin-right: 3px;
      transition: background .15s;
    }
    .tabs button.active { background: var(--main);}
    .tab-content { display: none; padding: 12px 0;}
    .tab-content.active { display: block;}
    .settings button {
      background-color: var(--accent);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 7px;
      font-size: 1.04rem;
      cursor: pointer;
      margin-bottom: 11px;
      display: block;
      width: 100%;
      text-align: left;
      letter-spacing: 1.1px;
    }
    /* èŠå¤©çª— */
    .market-chat-modal {
      position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999;
      background:rgba(0,0,0,0.13);
      display:flex;align-items:center;justify-content:center;
    }
    .market-chat-window {
      background:#fff;border-radius:16px;max-width:380px;width:97vw;
      box-shadow:0 2px 28px #aaa;padding:0 0 18px 0;position:relative;display:flex;flex-direction:column;
      max-height:82vh;
      overflow:hidden;
    }
    .market-chat-header {
      background: linear-gradient(90deg, var(--main-dark), var(--main));
      color:#fff;padding:16px 18px;font-weight:bold;border-top-left-radius:16px;border-top-right-radius:16px;
      font-size:1.13em;display:flex;align-items:center;justify-content:space-between;
    }
    .market-chat-messages {
      padding: 12px 16px;flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:9px;background:#f8fcf4;
    }
    .chat-message {
      background: #e9f7e7;
      border-radius: 15px;
      padding: 8px 12px;
      max-width: 78%;
      font-size: 0.99em;
      align-self: flex-start;
      margin-bottom: 0;
    }
    .chat-message.self {background: #f4b774; color:#fff; align-self: flex-end;}
    .market-chat-input-area {
      display:flex;gap:8px;padding:8px 14px 0 14px;background:#fff;
    }
    .market-chat-input-area input {
      flex:1; font-size:1em; border-radius:10px; border:1px solid #dbeed3; padding:8px 12px;
      background: #f9f9f9;
    }
    .market-chat-input-area button {
      background:var(--main);color:#fff;border:none;border-radius:8px;padding:8px 19px;font-weight:bold;cursor:pointer;
      transition:background .15s;font-size:1.03em;letter-spacing:1.1px;
    }
    /* éŸ¿æ‡‰å¼ */
    @media (max-width: 600px) {
      .header { font-size: 1.4rem; padding: 13px 0;}
      .container { padding: 12px 2vw 10px 2vw;}
      .profile-header img { width: 60px; height: 60px;}
      .footer-nav { height: 56px;}
    }
  </style>
</head>
<body>
  <!-- header -->
  <div id="main-header" class="header">SmartPantry é£Ÿç‰©ç®¡å®¶</div>

  <!-- ç™»å…¥/è¨»å†Šä»‹é¢ -->
  <div id="page-login" class="container">
    <div id="login-success" class="success-message"></div>
    <div id="login-error" class="error-message"></div>
    <!-- ç™»å…¥è¡¨å–® -->
    <form class="form-card" id="login-form" autocomplete="off">
      <div class="form-group">
        <label for="login-email">é›»å­éƒµä»¶ <span style="color:#d90429;">*</span></label>
        <input type="email" id="login-email" required placeholder="è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶">
        <div class="error-text" id="loginEmailError"></div>
      </div>
      <div class="form-group">
        <label for="login-password">å¯†ç¢¼ <span style="color:#d90429;">*</span></label>
        <input type="password" id="login-password" required placeholder="è«‹è¼¸å…¥æ‚¨çš„å¯†ç¢¼">
        <div class="error-text" id="loginPasswordError"></div>
      </div>
      <button class="button" id="login-btn" type="submit">ç™»å…¥</button>
      <div class="toggle-form" style="text-align:center;">
        é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿ<a href="#" id="to-register">ç«‹å³è¨»å†Š</a>
      </div>
    </form>
    <!-- è¨»å†Šè¡¨å–® -->
    <form class="form-card hidden" id="register-form" autocomplete="off">
      <div class="form-group">
        <label for="register-name">å§“å <span style="color:#d90429;">*</span></label>
        <input type="text" id="register-name" required placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
        <div class="error-text" id="registerNameError"></div>
      </div>
      <div class="form-group">
        <label for="register-email">é›»å­éƒµä»¶ <span style="color:#d90429;">*</span></label>
        <input type="email" id="register-email" required placeholder="è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶">
        <div class="error-text" id="registerEmailError"></div>
      </div>
      <div class="form-group">
        <label for="register-password">å¯†ç¢¼ <span style="color:#d90429;">*</span></label>
        <input type="password" id="register-password" required placeholder="è«‹è¼¸å…¥å¯†ç¢¼ï¼ˆè‡³å°‘6å€‹å­—ç¬¦ï¼‰">
        <div class="error-text" id="registerPasswordError"></div>
      </div>
      <div class="form-group">
        <label for="register-confirm">ç¢ºèªå¯†ç¢¼ <span style="color:#d90429;">*</span></label>
        <input type="password" id="register-confirm" required placeholder="è«‹å†æ¬¡è¼¸å…¥å¯†ç¢¼">
        <div class="error-text" id="registerConfirmError"></div>
      </div>
      <button class="button" id="register-btn" type="submit">è¨»å†Š</button>
      <div class="toggle-form" style="text-align:center;">
        å·²æœ‰å¸³è™Ÿï¼Ÿ<a href="#" id="to-login">ç«‹å³ç™»å…¥</a>
      </div>
    </form>
  </div>

  <!-- ä¸»é ï¼ˆå‹•æ…‹/åˆ†äº«ï¼‰ -->
  <div id="page-feed" class="container hidden">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom: 10px;">
      <div class="section-title" style="border:none; padding-left:0;">å‹•æ…‹åˆ†äº«</div>
    </div>
    <div class="section-title">æ¯æ—¥æ¨è–¦é£Ÿè­œ</div>
    <div id="feed-recipes"></div>
    <div class="section-title" style="margin-top:18px;">åˆ†äº«å‹•æ…‹</div>
    <div id="feed-stream"></div>
    <button class="btn-main" style="margin:22px 0 0 0;" onclick="showPostPopup()">æˆ‘è¦åˆ†äº«/ç™¼ä½ˆ</button>
  </div>

  <!-- é£Ÿè­œç”Ÿæˆå™¨ -->
  <div id="page-recipe" class="container hidden">
    <div class="section-title">æ™ºæ…§é£Ÿè­œç”Ÿæˆå™¨</div>
    <form class="form-card" id="recipeForm" autocomplete="off" novalidate>
      <div class="form-group">
        <label for="age">å¹´é½¡ <span style="color:#d90429;">*</span></label>
        <input type="number" id="age" name="age" placeholder="è«‹è¼¸å…¥æ‚¨çš„å¹´é½¡" min="1" max="120" required>
        <div class="error-text" id="ageError"></div>
      </div>
      <div class="form-group">
        <label for="allergens">éæ•åŸ</label>
        <input type="text" id="allergens" name="allergens" placeholder="è«‹è¼¸å…¥éæ•åŸï¼ˆä¾‹å¦‚ï¼šå …æœã€ä¹³è£½å“ï¼‰">
      </div>
      <div class="form-group">
        <label for="goal">é£²é£Ÿç›®æ¨™</label>
        <select id="goal" name="goal">
          <option value="lose-weight">æ¸›è„‚</option>
          <option value="gain-muscle">å¢è‚Œ</option>
          <option value="maintain">ä¿æŒå¥åº·</option>
        </select>
      </div>
      <div class="form-group">
        <label for="cuisineType">ä½ æƒ³åšä»€éº¼é¡å‹çš„èœå¼ï¼Ÿ</label>
        <select id="cuisineType" name="cuisineType">
          <option value="Chinese">ä¸­å¼</option>
          <option value="Western">è¥¿å¼</option>
          <option value="Vegetarian">ç´ é£Ÿ</option>
        </select>
      </div>
      <div class="form-group">
        <label for="prepTime">ä½ å¸Œæœ›é€™å€‹é£Ÿè­œçš„æº–å‚™æ™‚é–“å¤§ç´„æ˜¯å¤šä¹…ï¼Ÿ</label>
        <select id="prepTime" name="prepTime">
          <option value="30">30åˆ†é˜</option>
          <option value="60">1å°æ™‚</option>
          <option value="120">2å°æ™‚</option>
        </select>
      </div>
      <div class="form-group">
        <label for="ingredients">ä½ æ‰“ç®—ç”¨ä»€éº¼é£Ÿæï¼Ÿ</label>
        <input type="text" id="ingredients" name="ingredients" placeholder="ä¾‹å¦‚ï¼šé›è‚‰ã€ç•ªèŒ„">
      </div>
      <div class="form-group">
        <label for="servings">ä½ æœ‰å¹¾å€‹äººéœ€è¦é€™é“èœï¼Ÿ</label>
        <select id="servings" name="servings">
          <option value="1">1äºº</option>
          <option value="2">2äºº</option>
          <option value="4">4äºº</option>
          <option value="6">6äººä»¥ä¸Š</option>
        </select>
      </div>
      <button class="button" id="generate" type="submit">ç”Ÿæˆé£Ÿè­œ</button>
    </form>
    <div id="loading-message" class="success-message" style="display:none;">ç”Ÿæˆä¸­ï¼Œè«‹ç¨å€™...</div>
    <div id="error-message" class="error-message" style="display:none;"></div>
    <div class="section-title" id="recipe-section-title" style="display:none;">æ¨è–¦é£Ÿè­œ</div>
    <div id="recipe-container"></div>
  </div>

  <!-- é£Ÿç‰©æƒæèˆ‡ç®¡ç† -->
  <div id="page-scan" class="container hidden">
    <div class="section-title">æƒææˆ–æ–°å¢é£Ÿç‰©</div>
    <div class="scanner" style="display:flex; gap:10px; margin-bottom:16px;">
      <button class="btn-main" onclick="alert('æ­¤åŠŸèƒ½åƒ…ç¤ºæ„ï¼Œå¯æ¥ç›¸æ©ŸAPI')">æƒææ¢ç¢¼</button>
      <button class="btn-main" onclick="alert('æ­¤åŠŸèƒ½åƒ…ç¤ºæ„ï¼Œå¯æ¥ç›¸æ©ŸAPI')">æ‹æ”åŒ…è£</button>
    </div>
    <div class="section-title">æ‰‹å‹•æ–°å¢</div>
    <div class="form-card" style="margin-bottom:13px;">
      <div class="form-group">
        <label for="food-name">é£Ÿç‰©åç¨±</label>
        <input type="text" id="food-name" placeholder="ä¾‹å¦‚ï¼šç‰›å¥¶ã€é›è›‹">
      </div>
      <div class="form-group">
        <label for="expiry-date">åˆ°æœŸæ—¥</label>
        <input type="date" id="expiry-date">
      </div>
      <div class="form-group">
        <label for="quantity">æ•¸é‡</label>
        <input type="number" id="quantity" placeholder="ä¾‹å¦‚ï¼š1, 2">
      </div>
      <div class="form-group">
        <label for="food-photo">ç…§ç‰‡ï¼ˆå¯é¸ï¼‰</label>
        <input type="file" id="food-photo" accept="image/*">
      </div>
      <button class="btn-main" type="button" id="add-food-btn">æ–°å¢é£Ÿç‰©</button>
    </div>
    <div class="section-title">å³å°‡åˆ°æœŸ</div>
    <div id="scan-reminder-list"></div>
  </div>

  <!-- é£Ÿç‰©åˆ†äº«å¸‚é›† -->
  <div id="page-market" class="container hidden">
    <div class="section-title">é™„è¿‘çš„é£Ÿç‰©åˆ†äº«</div>
    <div class="map">åœ°åœ–å ä½ç¬¦ï¼ˆå¯æ•´åˆåœ°åœ–APIï¼‰</div>
    <div class="section-title">å¯åˆ†äº«çš„é£Ÿç‰©</div>
    <div id="market-food-list"></div>
  </div>

  <!-- å€‹äººæª”æ¡ˆ -->
  <div id="page-profile" class="container hidden">
    <div class="profile-header">
      <img id="profile-avatar" src="https://via.placeholder.com/80x80" alt="é ­åƒ">
      <div>
        <div class="name" id="profile-name">ç”¨æˆ¶åç¨±</div>
      </div>
    </div>
    <div class="tabs">
      <button id="tab-recipes" class="tab-button active" onclick="showProfileTab('recipes')">æˆ‘çš„é£Ÿè­œ</button>
      <button id="tab-shared" class="tab-button" onclick="showProfileTab('shared')">åˆ†äº«ç´€éŒ„</button>
    </div>
    <div id="profile-recipes" class="tab-content active"></div>
    <div id="profile-shared" class="tab-content"></div>
    <div class="section-title">è¨­å®š</div>
    <div class="settings">
      <button onclick="alert('å¥åº·è³‡æ–™æ›´æ–°åŠŸèƒ½æ•¬è«‹æœŸå¾…')">æ›´æ–°å¥åº·è³‡æ–™</button>
      <button onclick="alert('é€šçŸ¥åŠŸèƒ½æ•¬è«‹æœŸå¾…')">é€šçŸ¥é–‹é—œ</button>
      <button onclick="logout()">ç™»å‡º</button>
    </div>
  </div>

  <!-- ç™¼ä½ˆå‹•æ…‹/åˆ†äº« Popup -->
  <div id="post-popup" class="mask hidden" style="z-index:2000;">
    <div style="background:#fff; border-radius:14px; padding:28px 20px 17px 20px; box-shadow:0 2px 24px #999; max-width:360px; width:95vw; position:relative;">
      <button style="position:absolute; right:11px; top:11px; background:none; border:none; color:#888; font-size:1.3em; cursor:pointer;" onclick="hidePostPopup()">âœ–</button>
      <div style="font-weight:bold; color:#6aac6e; font-size:1.15em; margin-bottom:12px;">ç™¼ä½ˆåˆ†äº«/å‹•æ…‹</div>
      <input id="post-photo" type="file" accept="image/*" style="margin:0 0 9px 0;">
      <textarea id="post-content" rows="3" placeholder="è«‹è¼¸å…¥åˆ†äº«å…§å®¹..." style="width:100%; border-radius:7px; border:1px solid #ddd; font-size:1em; padding:8px;"></textarea>
      <button class="btn-main" style="margin-top:13px;" onclick="submitPost()">ç™¼ä½ˆ</button>
    </div>
  </div>

  <!-- å¸‚é›†èŠå¤©å½ˆçª— -->
  <div id="market-chat-modal" class="market-chat-modal hidden">
    <div class="market-chat-window">
      <div class="market-chat-header">
        <span id="chat-title">èˆ‡åˆ†äº«è€…èŠå¤©</span>
        <button style="background:none;border:none;color:#fff;font-size:1.3em;cursor:pointer;" onclick="closeMarketChat()">âœ–</button>
      </div>
      <div class="market-chat-messages" id="chat-messages"></div>
      <div class="market-chat-input-area">
        <input type="text" id="chat-input" placeholder="è¼¸å…¥è¨Šæ¯...">
        <button onclick="sendMarketMessage()">é€å‡º</button>
      </div>
    </div>
  </div>

  <!-- åº•éƒ¨å°èˆªæ¬„ -->
  <nav class="footer-nav" id="footer-nav" style="display:none;">
    <button id="nav-feed" onclick="switchPage('feed')" class="active">
      <svg viewBox="0 0 24 24" fill="none" width="25" height="25"><path d="M5 12h14M5 6h14M5 18h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <span>å‹•æ…‹</span>
    </button>
    <button id="nav-market" onclick="switchPage('market')">
      <svg viewBox="0 0 24 24" width="25" height="25" fill="none"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/><path d="M7 16l5-5 5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <span>å¸‚é›†</span>
    </button>
    <button id="nav-scan" onclick="switchPage('scan')">
      <svg viewBox="0 0 24 24" width="25" height="25" fill="none"><rect x="3" y="3" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="2"/><rect x="3" y="15" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="2"/><rect x="15" y="3" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="2"/><rect x="15" y="15" width="6" height="6" rx="1.5" stroke="currentColor" stroke-width="2"/></svg>
      <span>æƒæ</span>
    </button>
    <button id="nav-recipe" onclick="switchPage('recipe')">
      <svg width="25" height="25" fill="none" viewBox="0 0 24 24"><path d="M3.5 6.5A2.5 2.5 0 016 4h12a2.5 2.5 0 012.5 2.5v15a.5.5 0 01-.76.43l-5.24-3.27a1.5 1.5 0 00-1.56 0l-5.24 3.27A.5.5 0 015 21.5v-15z" stroke="currentColor" stroke-width="2"/></svg>
      <span>é£Ÿè­œ</span>
    </button>
    <button id="nav-profile" onclick="switchPage('profile')">
      <svg viewBox="0 0 24 24" width="25" height="25" fill="none"><circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2"/><path d="M4 20a8 8 0 1116 0" stroke="currentColor" stroke-width="2"/></svg>
      <span>å€‹äºº</span>
    </button>
  </nav>

  <!-- JSä¸»é‚è¼¯ -->
  <script>
    // æœ¬åœ°è³‡æ–™çµæ§‹
    const USER_STORAGE_KEY = 'sp_users';
    const CURRENT_USER_KEY = 'sp_current_user';
    const FEED_KEY = 'sp_feed';
    const SCAN_KEY = 'sp_scan_foods';
    const MARKET_CHAT_KEY = 'sp_market_chats';
    const RECIPE_KEY = 'sp_recipes';

    // é é¢åˆ‡æ›èˆ‡åˆå§‹åŒ–
    function switchPage(page) {
      document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
      document.getElementById('page-'+page).classList.remove('hidden');
      document.getElementById('main-header').textContent =
        page==='feed' ? 'SmartPantry é£Ÿç‰©ç®¡å®¶'
        : page==='market' ? 'é£Ÿç‰©åˆ†äº«å¸‚é›†'
        : page==='scan' ? 'é£Ÿç‰©æƒæèˆ‡ç®¡ç†'
        : page==='recipe' ? 'æ™ºæ…§é£Ÿè­œç”Ÿæˆå™¨'
        : page==='profile' ? 'å€‹äººæª”æ¡ˆ'
        : 'SmartPantry é£Ÿç‰©ç®¡å®¶';
      document.querySelectorAll('.footer-nav button').forEach(btn => btn.classList.remove('active'));
      if(page!=='login') document.getElementById('nav-'+page).classList.add('active');
      if(page==='feed') { showFeed(); }
      if(page==='market') { showMarket(); }
      if(page==='scan') { showScanFood(); }
      if(page==='profile') { showProfile(); }
    }

    function logout() {
      localStorage.removeItem(CURRENT_USER_KEY);
      localStorage.removeItem(RECIPE_KEY);
      location.reload();
    }

    // -------- ç™»å…¥/è¨»å†ŠåŠŸèƒ½ ---------
    function toRegister() {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('register-form').classList.remove('hidden');
      document.getElementById('login-success').style.display = 'none';
      document.getElementById('login-error').style.display = 'none';
      clearFormErrors();
    }
    function toLogin() {
      document.getElementById('register-form').classList.add('hidden');
      document.getElementById('login-form').classList.remove('hidden');
      document.getElementById('login-success').style.display = 'none';
      document.getElementById('login-error').style.display = 'none';
      clearFormErrors();
    }
    function showFormError(inputId, errorMessage) {
      const input = document.getElementById(inputId);
      const errorElement = document.getElementById(inputId+'Error');
      if(input && errorElement) {
        input.classList.add('input-error');
        errorElement.textContent = errorMessage;
      }
    }
    function clearFormErrors() {
      document.querySelectorAll('.error-text').forEach(el => el.textContent = '');
      document.querySelectorAll('input').forEach(el => el.classList.remove('input-error'));
    }
    function showLoginSuccess(msg) {
      const el = document.getElementById('login-success');
      el.textContent = msg;
      el.style.display = 'block';
      document.getElementById('login-error').style.display = 'none';
    }
    function showLoginError(msg) {
      const el = document.getElementById('login-error');
      el.textContent = msg;
      el.style.display = 'block';
      document.getElementById('login-success').style.display = 'none';
    }
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
    function getUsers() {
      const usersJson = localStorage.getItem(USER_STORAGE_KEY);
      return usersJson ? JSON.parse(usersJson) : [];
    }
    function saveUsers(users) {
      localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(users));
    }
    function setCurrentUser(user) {
      const userInfo = { id: user.id, name: user.name, email: user.email };
      localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(userInfo));
    }
    function getCurrentUser() {
      const userJson = localStorage.getItem(CURRENT_USER_KEY);
      return userJson ? JSON.parse(userJson) : null;
    }
    document.getElementById('register-form').addEventListener('submit', function(e){
      e.preventDefault(); clearFormErrors();
      const name = document.getElementById('register-name').value.trim();
      const email = document.getElementById('register-email').value.trim();
      const password = document.getElementById('register-password').value;
      const confirm = document.getElementById('register-confirm').value;
      let valid = true;
      if(!name) { showFormError('register-name','è«‹è¼¸å…¥æ‚¨çš„å§“å'); valid=false; }
      if(!email) { showFormError('register-email','è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶'); valid=false; }
      else if(!isValidEmail(email)) { showFormError('register-email','è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶'); valid=false; }
      if(!password) { showFormError('register-password','è«‹è¼¸å…¥å¯†ç¢¼'); valid=false; }
      else if(password.length<6) { showFormError('register-password','å¯†ç¢¼è‡³å°‘6å€‹å­—ç¬¦'); valid=false; }
      if(!confirm || password!==confirm) { showFormError('register-confirm','å…©æ¬¡å¯†ç¢¼ä¸ä¸€è‡´'); valid=false; }
      if(!valid) return;
      const users = getUsers();
      if(users.some(u=>u.email===email)) { showFormError('register-email','æ­¤é›»å­éƒµä»¶å·²è¢«è¨»å†Š'); return;}
      const newUser = { id: Date.now()+'', name, email, password };
      users.push(newUser); saveUsers(users); setCurrentUser(newUser);
      showLoginSuccess('è¨»å†ŠæˆåŠŸï¼Œæ­¡è¿æ‚¨ï¼');
      setTimeout(()=>{ showAppAfterLogin(); }, 900);
    });
    document.getElementById('login-form').addEventListener('submit', function(e){
      e.preventDefault(); clearFormErrors();
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      let valid = true;
      if(!email) { showFormError('login-email','è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶'); valid=false; }
      if(!password) { showFormError('login-password','è«‹è¼¸å…¥æ‚¨çš„å¯†ç¢¼'); valid=false; }
      if(!valid) return;
      const users = getUsers();
      const user = users.find(u=>u.email===email && u.password===password);
      if(!user) { showLoginError('é›»å­éƒµä»¶æˆ–å¯†ç¢¼ä¸æ­£ç¢º'); return;}
      setCurrentUser(user);
      showLoginSuccess('ç™»å…¥æˆåŠŸï¼');
      setTimeout(()=>{ showAppAfterLogin(); }, 700);
    });
    document.getElementById('to-register').onclick = toRegister;
    document.getElementById('to-login').onclick = toLogin;
    document.querySelectorAll('input').forEach(input=>{
      input.addEventListener('input', function(){
        this.classList.remove('input-error');
        const errorElement = document.getElementById(this.id+'Error');
        if(errorElement) errorElement.textContent = '';
      });
    });

    function showAppAfterLogin() {
      document.getElementById('page-login').classList.add('hidden');
      document.getElementById('footer-nav').style.display = 'flex';
      switchPage('feed');
    }
    function checkLogin() {
      if(getCurrentUser()) {
        document.getElementById('page-login').classList.add('hidden');
        document.getElementById('footer-nav').style.display = 'flex';
        switchPage('feed');
      } else {
        document.getElementById('page-login').classList.remove('hidden');
        document.getElementById('footer-nav').style.display = 'none';
        document.querySelectorAll('.container').forEach(c=>{
          if(c.id!=='page-login') c.classList.add('hidden');
        });
      }
    }
    window.addEventListener('DOMContentLoaded', checkLogin);

    // ------- ä¸»é  Feed èˆ‡åˆ†äº«å‹•æ…‹ -------
    function showFeed() {
      // æ¨è–¦é£Ÿè­œ
      let recList = JSON.parse(localStorage.getItem(RECIPE_KEY)||'[]');
      let html = '';
      if(recList.length===0) html = '<div style="color:#888;">æš«ç„¡æ¨è–¦é£Ÿè­œï¼Œå¯æ–¼ã€Œé£Ÿè­œã€é ç”Ÿæˆ</div>';
      else recList.forEach(r=>{
        html += `<div class="card">
          <div style="font-weight:bold;color:#e08e3b;">${r.title}</div>
          <div style="font-size:0.98em;margin:4px 0;">ç†±é‡ï¼š${r.nutrition?.calories ?? '-'} å¤§å¡</div>
          <div style="font-size:0.97em;">${r.ingredients?.slice(0,2).join('ã€')??''}...</div>
          <button class="btn-main" style="margin-top:10px;" onclick='showRecipeDetail(${JSON.stringify(r)})'>è©³ç´°</button>
        </div>`;
      });
      document.getElementById('feed-recipes').innerHTML = html;
      // åˆ†äº«å‹•æ…‹
      let feed = JSON.parse(localStorage.getItem(FEED_KEY)||'[]');
      if(feed.length===0) document.getElementById('feed-stream').innerHTML = '<div style="color:#888;">æš«ç„¡åˆ†äº«å‹•æ…‹ï¼Œå¿«ä¾†ç™¼ä½ˆï¼</div>';
      else document.getElementById('feed-stream').innerHTML = feed.slice().reverse().map(post=>{
        return `<div class="feed-post">
          <div class="feed-avatar">${post.avatar||'ğŸ‘¤'}</div>
          <div class="feed-content">
            <div class="feed-user">${post.user}</div>
            <div class="feed-text">${post.text}</div>
            ${post.img?`<img class="feed-image" src="${post.img}" alt="åˆ†äº«åœ–">`:""}
          </div>
        </div>`;
      }).join('');
    }
    // ç™¼ä½ˆåˆ†äº«popup
    function showPostPopup() {
      document.getElementById('post-popup').classList.remove('hidden');
      document.getElementById('post-content').value = '';
      document.getElementById('post-photo').value = '';
    }
    function hidePostPopup() {
      document.getElementById('post-popup').classList.add('hidden');
    }
    function submitPost() {
      let txt = document.getElementById('post-content').value.trim();
      let imgInput = document.getElementById('post-photo');
      let reader = new FileReader();
      if(!txt && !imgInput.files[0]) { alert('è«‹è¼¸å…¥å…§å®¹æˆ–ä¸Šå‚³åœ–ç‰‡'); return; }
      let pushPost = (imgBase64='') => {
        let cu = getCurrentUser();
        let feed = JSON.parse(localStorage.getItem(FEED_KEY)||'[]');
        feed.push({
          id: Date.now()+'',
          user: cu.name,
          avatar: 'ğŸ‘¤',
          text: txt,
          img: imgBase64
        });
        localStorage.setItem(FEED_KEY, JSON.stringify(feed));
        hidePostPopup(); showFeed();
      };
      if(imgInput.files && imgInput.files[0]) {
        reader.onload = function(e){ pushPost(e.target.result);}
        reader.readAsDataURL(imgInput.files[0]);
      } else {
        pushPost();
      }
    }

    // ------- é£Ÿè­œç”Ÿæˆå™¨ -------
    document.getElementById('recipeForm').addEventListener('submit', function(e){
      e.preventDefault();
      let age = document.getElementById('age').value.trim();
      if(!age || age<1 || age>120) {
        document.getElementById('age').classList.add('input-error');
        document.getElementById('ageError').textContent = 'è«‹è¼¸å…¥1-120ä¹‹é–“çš„æœ‰æ•ˆå¹´é½¡ã€‚';
        return;
      }
      document.getElementById('age').classList.remove('input-error');
      document.getElementById('ageError').textContent = '';
      document.getElementById('loading-message').style.display = 'block';
      document.getElementById('error-message').style.display = 'none';
      setTimeout(()=>{ // æ¨¡æ“¬AIè™•ç†
        document.getElementById('loading-message').style.display = 'none';
        let sample = [
          {
            "title": "ç•ªèŒ„ç‚’è›‹",
            "ingredients": ["é›è›‹ 2é¡†","ç•ªèŒ„ 1é¡†","è”¥èŠ± 10å…‹","é¹½ å°‘è¨±"],
            "steps": ["ç•ªèŒ„åˆ‡å¡Šã€è›‹æ‰“æ•£ã€‚","ç†±é‹åŠ æ²¹ç‚’ç•ªèŒ„ï¼Œæ”¾è›‹æ¶²ç…®ç†Ÿã€‚","åŠ è”¥èŠ±é¹½æ‹Œå‹»å³å¯ã€‚"],
            "nutrition": {calories: 270, protein: 16, carbs: 10, fat: 16, fiber: 2, sodium: 200},
            "tags": ["å¿«é€Ÿæ–™ç†","é«˜è›‹ç™½"]
          },
          {
            "title": "è”¥æ²¹é›èƒ¸",
            "ingredients": ["é›èƒ¸è‚‰ 200å…‹","è”¥ 30å…‹","è–‘ç‰‡ 3ç‰‡","é¹½èƒ¡æ¤’ é©é‡"],
            "steps":["é›èƒ¸ç…®ç†Ÿæ’•ç‰‡ã€‚","è”¥è–‘åˆ‡æœ«ç†±æ²¹æ·‹ä¸Šï¼Œæ‹Œå…¥é›èƒ¸ã€‚"],
            "nutrition": {calories: 220, protein: 38, carbs: 2, fat: 7, fiber: 0, sodium: 180},
            "tags": ["ä½è„‚","æ¸›è„‚"]
          },
          {
            "title": "æ¶¼æ‹Œé®®è”¬æ²™æ‹‰",
            "ingredients": ["ç”Ÿèœ 50å…‹","å°é»ƒç“œ 1æ ¹","ç‰ç±³ç²’ 30å…‹","æ©„æ¬–æ²¹ 1æ¹¯åŒ™"],
            "steps":["è”¬èœæ´—å¥½åˆ‡å¡Šæ‹Œå‹»ã€‚","åŠ æ©„æ¬–æ²¹æ‹Œå‹»å³å¯ã€‚"],
            "nutrition": {calories: 95, protein: 3, carbs: 8, fat: 5, fiber: 3, sodium: 40},
            "tags": ["ç´ é£Ÿ","å¿«é€Ÿæ–™ç†"]
          }
        ];
        document.getElementById('recipe-section-title').style.display = 'block';
        let html = '';
        sample.forEach(r=>{
          html += `<div class="recipe-card">
            <div style="font-weight:bold;color:#e08e3b; font-size:1.08em;">${r.title}</div>
            <div class="recipe-ingredients"><b>æ‰€éœ€é£Ÿæï¼š</b>${r.ingredients.join("ã€")}</div>
            <div><b>è£½ä½œæ­¥é©Ÿï¼š</b><ol>${r.steps.map(x=>'<li>'+x+'</li>').join('')}</ol></div>
            <div class="recipe-nutrition"><b>ç‡Ÿé¤Šï¼š</b>
            ç†±é‡ï¼š${r.nutrition.calories} å¤§å¡ï¼Œ
            è›‹ç™½è³ªï¼š${r.nutrition.protein}gï¼Œ
            ç¢³æ°´åŒ–åˆç‰©ï¼š${r.nutrition.carbs}gï¼Œ
            è„‚è‚ªï¼š${r.nutrition.fat}gï¼Œ
            è†³é£Ÿçº–ç¶­ï¼š${r.nutrition.fiber}gï¼Œ
            éˆ‰ï¼š${r.nutrition.sodium}mg
            </div>
            <div class="recipe-tags"><b>æ¨™ç±¤ï¼š</b>${r.tags.join("ã€")}</div>
            <button class="btn-main" onclick='addRecipeToProfile(${JSON.stringify(r)})'>åŠ å…¥æˆ‘çš„é£Ÿè­œ</button>
          </div>`;
        });
        document.getElementById('recipe-container').innerHTML = html;
        localStorage.setItem(RECIPE_KEY, JSON.stringify(sample));
      }, 1200);
    });

    // ------- é£Ÿç‰©æƒæèˆ‡ç®¡ç† -------
    function showScanFood() {
      let foods = JSON.parse(localStorage.getItem(SCAN_KEY)||'[]');
      let html = '';
      if(!foods.length) html = '<div style="color:#888;">æš«ç„¡é£Ÿç‰©ï¼Œè«‹æ–°å¢ï¼</div>';
      else {
        foods.forEach((f,idx)=>{
          let days = Math.max(0, Math.ceil((new Date(f.expiry)-new Date())/86400000));
          html += `<div class="reminder-card">
            <div style="display:flex;gap:15px;align-items:center;">
              ${f.img ? `<img src="${f.img}" class="market-food-img" style="width:60px;height:60px;">` : ''}
              <div>
                <div class="details">${f.name}</div>
                <div class="expiry">å‰©é¤˜ ${days} å¤©</div>
                <div class="qty">æ•¸é‡ï¼š${f.qty||1}</div>
              </div>
            </div>
            <button class="btn-main" style="margin-top:8px;" onclick="shareFoodFromScan(${idx})">åˆ†äº«</button>
          </div>`;
        });
      }
      document.getElementById('scan-reminder-list').innerHTML = html;
      document.getElementById('food-name').value='';
      document.getElementById('expiry-date').value='';
      document.getElementById('quantity').value='';
      document.getElementById('food-photo').value='';
    }
    document.getElementById('add-food-btn').onclick = function() {
      let name = document.getElementById('food-name').value.trim();
      let expiry = document.getElementById('expiry-date').value;
      let qty = parseInt(document.getElementById('quantity').value)||1;
      let imgInput = document.getElementById('food-photo');
      if(!name||!expiry) { alert('è«‹è¼¸å…¥å®Œæ•´'); return;}
      let foods = JSON.parse(localStorage.getItem(SCAN_KEY)||'[]');
      if(imgInput.files && imgInput.files[0]) {
        let reader = new FileReader();
        reader.onload = function(e) {
          foods.push({name,expiry,qty,img:e.target.result});
          localStorage.setItem(SCAN_KEY, JSON.stringify(foods));
          showScanFood();
        };
        reader.readAsDataURL(imgInput.files[0]);
      } else {
        foods.push({name,expiry,qty,img:""});
        localStorage.setItem(SCAN_KEY, JSON.stringify(foods));
        showScanFood();
      }
    };
    function shareFoodFromScan(idx) {
      let foods = JSON.parse(localStorage.getItem(SCAN_KEY)||'[]');
      let f = foods[idx];
      let cu = getCurrentUser();
      let feed = JSON.parse(localStorage.getItem(FEED_KEY)||'[]');
      feed.push({
        id: Date.now()+'',
        user: cu.name,
        avatar: 'ğŸ‘¤',
        text: `åˆ†äº«${f.name} ${f.qty||1}ä»½ï¼Œæœ‰éœ€è¦å¯è¯çµ¡æˆ‘ï¼`,
        img: f.img||''
      });
      localStorage.setItem(FEED_KEY, JSON.stringify(feed));
      foods.splice(idx,1);
      localStorage.setItem(SCAN_KEY, JSON.stringify(foods));
      showScanFood();
      alert('å·²åˆ†äº«è‡³å‹•æ…‹ï¼');
    }

    // ------- å¸‚é›†åˆ†äº«èˆ‡èŠå¤© -------
    function showMarket() {
      // å¸‚é›†èˆ‡åˆ†äº«å‹•æ…‹æ•´åˆï¼ˆåƒ…å±•ç¤ºæ‰€æœ‰å·²åˆ†äº«éçš„é£Ÿç‰©ï¼‹ç…§ç‰‡ï¼‰
      let feed = JSON.parse(localStorage.getItem(FEED_KEY)||'[]');
      let html = '';
      if(feed.length === 0) {
        html = '<div style="color:#888;">æš«ç„¡å¯åˆ†äº«é£Ÿç‰©ï¼</div>';
      } else {
        html = feed.slice().reverse().map(f=>`
          <div class="food-card">
            ${f.img? `<img src="${f.img}" alt="Food Image">` : ''}
            <div class="content">
              <div class="title">${f.text.replace(/^åˆ†äº«/,"").replace(/æœ‰éœ€è¦å¯è¯çµ¡æˆ‘ï¼/,"").trim().substring(0,16)}</div>
              <div class="details">åˆ†äº«è€…ï¼š${f.user}</div>
              <div class="actions">
                <button class="btn-main" onclick="openMarketChat('${f.user}')">è¯çµ¡åˆ†äº«è€…</button>
              </div>
            </div>
          </div>
        `).join('');
      }
      document.getElementById('market-food-list').innerHTML = html;
    }

    // å¸‚é›†èŠå¤©ï¼šæœ¬åœ°æ¨¡æ“¬ã€åŒä¸€è£ç½®ä¸‹å¯ç•™è¨€ï¼Œå¯¦éš›æ‡‰ç”¨éœ€å¾Œç«¯æ”¯æ´
    function openMarketChat(user) {
      let cu = getCurrentUser();
      let chatId = [cu.name, user].sort().join('_');
      document.getElementById('market-chat-modal').classList.remove('hidden');
      document.getElementById('chat-title').textContent = 'èˆ‡åˆ†äº«è€… ' + user + ' èŠå¤©';
      document.getElementById('chat-input').value = '';
      renderMarketChat(chatId, cu.name);
      document.getElementById('market-chat-modal').dataset.chatId = chatId;
      document.getElementById('market-chat-modal').dataset.self = cu.name;
    }
    function renderMarketChat(chatId, selfName) {
      let allChats = JSON.parse(localStorage.getItem(MARKET_CHAT_KEY)||'{}');
      let chats = allChats[chatId]||[];
      let msgHtml = chats.map(msg=>`
        <div class="chat-message${msg.user===selfName?' self':''}">${msg.user}ï¼š${msg.text}</div>
      `).join('');
      document.getElementById('chat-messages').innerHTML = msgHtml;
      setTimeout(()=> {
        let el = document.getElementById('chat-messages');
        el.scrollTop = el.scrollHeight;
      }, 50);
    }
    function closeMarketChat() {
      document.getElementById('market-chat-modal').classList.add('hidden');
    }
    function sendMarketMessage() {
      let chatId = document.getElementById('market-chat-modal').dataset.chatId;
      let self = document.getElementById('market-chat-modal').dataset.self;
      let txt = document.getElementById('chat-input').value.trim();
      if(!txt) return;
      let allChats = JSON.parse(localStorage.getItem(MARKET_CHAT_KEY)||'{}');
      if(!allChats[chatId]) allChats[chatId] = [];
      allChats[chatId].push({user:self, text:txt, time:Date.now()});
      localStorage.setItem(MARKET_CHAT_KEY, JSON.stringify(allChats));
      document.getElementById('chat-input').value = '';
      renderMarketChat(chatId, self);
    }

    // ------- å€‹äººæª”æ¡ˆ -------
    function showProfile() {
      let cu = getCurrentUser();
      document.getElementById('profile-name').textContent = cu?.name||'ç”¨æˆ¶åç¨±';
      // æˆ‘çš„é£Ÿè­œ
      let recList = JSON.parse(localStorage.getItem(RECIPE_KEY)||'[]');
      let html = '';
      if(!recList.length) html = '<div style="color:#888;">å°šæœªå„²å­˜é£Ÿè­œï¼</div>';
      else recList.forEach(r=>{
        html += `<div class="list-item">
          <div class="title">${r.title}</div>
          <div class="details">ç†±é‡ï¼š${r.nutrition?.calories} å¤§å¡ | ${r.tags?.join("ã€")}</div>
        </div>`;
      });
      document.getElementById('profile-recipes').innerHTML = html;
      // åˆ†äº«ç´€éŒ„
      let feed = JSON.parse(localStorage.getItem(FEED_KEY)||'[]');
      let html2 = '';
      if(!feed.length) html2 = '<div style="color:#888;">å°šæœªåˆ†äº«éé£Ÿç‰©ï¼</div>';
      else feed.filter(x=>x.user===cu.name).forEach((f,i)=>{
        html2 += `<div class="list-item">
          <div class="title">åˆ†äº«ç´€éŒ„ ${i+1}</div>
          <div class="details">${f.text}${f.img?'<img src="'+f.img+'" style="width:30px;height:30px;margin-left:8px;border-radius:6px;">':''}</div>
        </div>`;
      });
      document.getElementById('profile-shared').innerHTML = html2 || '<div style="color:#888;">å°šæœªåˆ†äº«éé£Ÿç‰©ï¼</div>';
    }
    function showProfileTab(tab) {
      document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
      document.getElementById('profile-'+tab).classList.add('active');
      document.querySelectorAll('.tabs button').forEach(e=>e.classList.remove('active'));
      document.getElementById('tab-'+tab).classList.add('active');
    }

    // é¦–æ¬¡è‡ªå‹•åˆ‡æ›ç™»å…¥é 
    if(!getCurrentUser()) {
      switchPage('login');
    }

    // é é¢åˆ‡æ›æ™‚è‡ªå‹•æ»¾é ‚
    function scrollTopOnPageSwitch() {window.scrollTo(0,0);}
    document.querySelectorAll('.footer-nav button').forEach(btn=>{
      btn.addEventListener('click', scrollTopOnPageSwitch);
    });

    // èŠå¤©è¦–çª—æŒ‰ enter å¯é€å‡º
    document.getElementById('chat-input').addEventListener('keydown', function(e){
      if(e.key==='Enter'){
        e.preventDefault(); sendMarketMessage();
      }
    });
  </script>
</body>
</html>